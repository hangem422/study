# DNS Round Robin

라운드 로빈 DNS는 별도의 소프트웨어 혹은 하드웨어 로드밸런싱 장비를 사용하지 않고, DNS만을 이용하여 도메인 레코드 정보를 조회하는 시점에서 트래픽을 분산하는 기법입니다. 웹 뿐만 아니라, 도메인을 사용하는 모든 서비스(FTP, SMTP, TURN 등)에서 사용이 가능합니다.

## 1. DNS 라운드 로빈의 원리

웹 서버로 예를 들자면, 웹 서비스를 담당할 여러 대의 웹 서버는 자신의 공인 IP를 각각 가지고 있습니다. 웹 사이트에 접속을 원하는 사용자가 해당 도메인 주소를 브라우저에 입력하면, DNS는 도메인 정보를 조회하는데, 이때 IP 주소를 여러대의 서버 IP 리스트 중에서 라운드 로빈 형태로 랜덤하게 하나 혹은 여러개를 선택하여 다시 사용자에게 알려줍니다.

결과적으로 웹 사이트에 접속하는 다수의 사용자는 실제로는 복수의 웹 서버에 나뉘어 접속하게 되면서 자연스럽게 서버의 부하가 분산되는 방식입니다. DNS 조회 결과로 1개의 IP만 DNS 조회되는 경우도 있지만, 최근에는 복수의 IP를 모두 (순서를 정해서) 제공하고 클라이언트로 하여금 선택하도록 합니다.

## 2. 언제 사용하는가?

라운드 로빈 DNS는 지리적으로 복수의 웹 서버가 멀리 떨어져있어도, 실시간으로 헬스 체크가 어려울 떄 사용합니다.

## 3. DNS Round Robin 방식의 문제점

### 3.1 서버의 수만큼 IP 주소가 필요합니다.

부하 분산을 위해 서버의 대수를 늘리기 위해서는 그 만큼의 공인 IP가 필요합니다.

### 3.2 균등하게 분산되지 않습니다.

모바일 사이트 등에서 문제가 될 수 있는데, 스마트폰의 접속은 캐리어 게이트웨이라는 프록시 서버를 경유합니다. 프록시 서버에는 이름 변환 결과가 일정 시간 동안 캐싱되므로 같은 프록시 서버를 경유하는 접속은 항상 같은 서버로 접속됩니다. 또한 PC 용 웹 브라우조더 DNS 질의 결과를 캐싱하기 때문에 균등하게 부하분산 되지 않습니다. DNS 캐싱 주기(TTL) 값을 짧게 설정함으로서 어느정도 해소가 되지만, TTL에 다라 캐시를 해제하는 것은 아니므로 반드시 주의가 필요합니다.

### 3.3 서버가 다운되도 확인이 불가합니다.

일반적으로 **로드밸런싱**(Load Balancing)은 뒤 단에 있는 백 엔드 서버들의 **헬스 체크**(Health Check) 정보를 수반하지만, 라운드 로빈 DNS는 로드밸런싱 기능이 없기에 별도의 헬스 체크가 없습니다. 웹 서버의 부하가 높아서 응답이 느려지거나 접속수가 꽉 차서 접속을 처리할 수 없는 상황인지를 전혀 감지할 수 없기 때문에 어떤 원인으로 다운되더라도 이를 검출하지 못하고 유저들에게 제공합니다. 이 떄문에 유저들은 간혹 다운된 서버로 연결이 되기도 합니다. DNS 라운드 로빈은 어디까지나 부하분산을 위한 방법이지 다중화 방법은 아니므로 다른 S/W와 조합해서 관리할 필요가 있습니다.

## 4. DNS 스케줄링 알고리즘

### 4.1 Weight Round Robin (WRR)

각각의 웹 서버에 가중치를 가미해서 분산 비율을 변경합니다. 물론 가중치가 큰 서버일수록 빈번하게 선택되므로 처리 능력이 높은 서버는 가중치를 높게 설정하는 것이 좋습니다.

### 4.2 Least Connection

접속 클라이언트 수가 가장 적은 서버를 선택ㄷ합니다. 로드 밸런서에 실시간으로 Connection 수를 관라하거나 각 서버에서 주기적으로 알려주는 것이 필요합니다.

## 5. 출처

- [Interview_Question_for_Beginner - JaeYeopHan](https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/Development_common_sense)
- [라운드 로빈(Round Robin) DNS를 활용한 로드 밸런싱(Load Balancing) - Tech유람](https://m.blog.naver.com/sehyunfa/221691155719)
