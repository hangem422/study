# NoSQL

관계형 데이터 모델을 지양하며, 대량의 분산된 데이터를 저장하고 조회하는데 특화되어있으며, 스키마 없이 사용 가능하나 느슨한 스키마를 제공하는 저장소를 말합니다.

종류마다 쓰기/읽기 성능 특화, 2차 인덱스 지원, 오토 샤딩 지원 같은 고유한 특징을 가집니다. 대량의 데이터를 바르게 처리하기 위해 메모리에 임시 저장하고 응답하는 등의 방법을 사용합니다. 동적인 스케일 아웃을 지원하기도 하며, 가용성을 위하여 데이터 복제 등의 방법으로 관계형 데이터베이스가 제공하지 못하는 성능과 특성을 제공합니다.

## 1. CAP 이론

### 1.1 일관성 (Consistency)

일관성은 동시성 또는 동일성이라고도 하며, 다중 클라이언트에서 같은 시가넹 조회하는 데이터는 항상 동일한 데이터임을 보증하는 것을 의미합니다. 이것은 관계형 데이터베이스가 지원하는 가장 기본적인 기능이지만 일관성을 지원하지 않는 NoSQL을 사용한다면 데이터의 일관성이 느슨하게 처리되어 동일한 데이터가 나타나지 않을 수 있습니다. 느슨하게 처리된다는 것은 데이터의 변경을 시간의 흐름에 따라 여러 노드에 전파하는 것을 말합니다. 이러한 방법은 최종적으로 일관성이 유지된다고 하여 최종 일관성 또는 궁극적 일관성을 지원합니다.

각 NoSQL들은 분산 노드 간의 데이터 동기화를 위해서 두 가지 방법을 사용합니다. 첫번쨰로 데이터의 저장 결과를 클라이언트로 응답하기 전에 모든 노드에 데이터를 저장하는 동기식 방법이 있습니다. 그 만큼 느린 응답시간을 보이지만 데이터의 정합성을 보장합니다. 두 번째로 메모리나 임시 파일에 기록하고 클라이언트 먼저 응답한 다음, 특정 이벤트 또는 프로세스를 사용하여 노드로 데이터를 동기화하는 비동기식 방법이 있습니다. 바른 응답시간을 보인다는 장점이 있지만, 쓰기 노드에 장애가 발생하였을 경우 데이터가 손실될 수 있습니다.

### 1.2 가용성 (Availability)

가용성이란 모든 클라이언트의 읽기와 쓰기 요청에 대하여 항상 응답이 가능해야 함을 보증하는 것이며 내고장성이라고 합니다. 내고장성을 가진 NoSQL은 클러스터 내에서 몇 개의 노드가 망가지더라도 정상적인 서비스가 가능합니다.

몇몇 NoSQL은 가용성을 보장하기 위해 **데이터 복제**(Data Replication)을 사용합니다. 동일한 데이터를 다중 노드에 중복 저장하여 그 중 몇대의 노드가 고장나도 데이터가 유실되지 않도록 하는 방법입니다. 데이터 중복 저장 방법에 동일한 데이터를 가진 저장소를 하나 더 생산하는 Master-Slave 복제 방법과 데이터 단위로 중복 저장하는 Pear-To-Pear 복제 방법이 있습니다.

### 1.3 네트워크 허용성 (Partition Tolerance)

분할 허용성이란 지역적으로 분할된 네트워크 환경에서 동작하는 시스템에서 두 지역 간의 네트워크가 단절되거나 네트워크 데이터의 유실이 일어나더라도 각 지역 내의 시스템은 정상적으로 동작해야 함을 의미합니다.

## 2. 저장 방식에 따른 분류

### 2.1 Key-Value Model

가장 기본적인 형태의 NoSQL이며 키 하나로 데이터 하나를 저장하고 조회할 수 있는 단일 키-값 구조를 갖습니다. 단순한 저장구조로 인하여 복잡한 조회 연산을 지원하지 않습니다. 또한 고속 읽기와 쓰기에 최적화된 경우가 많습니다. 사용자의 프로필 정보, 웹 서버 클라스터를 위한 세션 정보, 장바구니 정보, URL 단축 정보 저장 등에 사용합니다. 하나의 서비스 요청에 다수의 데이터 조회 및 수정 연산이 발생하면 트렌잭션 처리가 불가능하여 데이터 정합성을 보장할 수 없습니다.

### 2.2 Document Model

키-값 모델을 개념적으로 확장한 구조로 하나의 키에 하나의 구조화된 문서를 저장하고 조회합니다. 논리적인 데이터 저장과 조회 방법이 관계형 데이터베이스와 유사합니다. 키는 문서에 대한 ID로 표현됩니다. 또한 ㅈ버장된 문서를 컬렉션으로 관리하여 문서 저장과 동시에 문서 ID에 대한 Index를 생성합니다. 문서 ID에 대한 인덱스를 사용하여 O(1) 시간 안에 문서를 조회할 수 있습니다.

대부분의 문서 모델 NoSQL은 B 트리 인덱스를 사용하여 2차원 인덱스를 생성합니다. B 트리는 크기가 커지면 커질수록 새로운 데이터를 입력하거나 삭제할 때 성능이 떨어지게 됩니다. 그렇기 때문에 읽기와 쓰기의 비율이 7:3 정도일 때 가장 좋은 성능을 보입니다. 중앙 집중식 로그 저장, 타임라인 저장, 통계 정보 저장 등에 사용됩니다.

### 2.3 Cloumn Model

하나의 키에 여러 개의 커럼 값의 쌍으로 이루어진 데이터를 저장하고 조회합니다. 모든 컬럼은 항상 타임 스탬프 값과 함께 저장됩니다.

## 3. 출처

- [Interview_Question_for_Beginner - JaeYeopHan](https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/Database#index)
